---
- name: Deploy simple HTML site
  hosts: localhost
  become: yes
  tasks:

    - name: Ensure site directory exists
      file:
        path: /var/lib/jenkins/site
        state: directory
        mode: '0755'

    - name: Ensure Dockerfile exists
      copy:
        content: |
          FROM httpd:latest
          COPY ./index.html /usr/local/apache2/htdocs/index.html
        dest: /var/lib/jenkins/site/Dockerfile
        mode: '0644'

    - name: Ensure index.html exists
      copy:
        content: "<h1>Hello from Ansible!</h1>"
        dest: /var/lib/jenkins/site/index.html
        mode: '0644'

    - name: Build Docker image
      shell: docker build -t site .
      args:
        chdir: /var/lib/jenkins/site

    - name: Remove old container if exists
      shell: docker rm -f site || true

    - name: Run Docker container
      shell: docker run --name site -d -p 5000:80 site

